<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BUILT Fuel Calculator</title>
</head>
<body>
<div style="max-width: 700px; margin: auto; font-family: Arial, sans-serif; padding: 20px; background-color: #1a1a1a; color: #f5f5f5; border-radius: 10px; box-shadow: 0 0 10px rgba(0,0,0,0.5);">
    <h2 style="text-align: center;">BUILT Fuel Calculator</h2>
    <p style="text-align: center; margin-bottom: 30px; opacity: 0.9;">Calculate the BEST maintenance macros for your LIFE.</p>

    <form id="macroCalculator">
        <!-- Basic Information -->
        <h3 style="color: #f5f5f5; margin: 25px 0 15px 0; border-bottom: 1px solid #333; padding-bottom: 8px;">Basic Information</h3>
        
        <div style="display: flex; gap: 15px; margin-bottom: 15px;">
            <div style="flex: 1;">
                <label>Age</label>
                <input id="age" name="age" type="number" min="16" max="80" required placeholder="e.g. 25" style="width:100%; padding:10px; background:#2a2a2a; color:#fff; border:1px solid #444; border-radius:5px; margin-bottom:10px;">
            </div>
            <div style="flex: 1;">
                <label>Biological Sex</label>
                <select id="gender" name="gender" required style="width:100%; padding:10px; background:#2a2a2a; color:#fff; border:1px solid #444; border-radius:5px; margin-bottom:10px;">
                    <option value="">Select</option>
                    <option value="male">Male</option>
                    <option value="female">Female</option>
                </select>
            </div>
        </div>

        <div style="display: flex; gap: 15px; margin-bottom: 15px;">
            <div style="flex: 1;">
                <label>Height</label>
                <div style="display: flex; gap: 10px;">
                    <input id="heightFeet" name="heightFeet" type="number" placeholder="Feet" min="4" max="7" style="flex:1; padding:10px; background:#2a2a2a; color:#fff; border:1px solid #444; border-radius:5px;">
                    <input id="heightInches" name="heightInches" type="number" placeholder="Inches" min="0" max="11" style="flex:1; padding:10px; background:#2a2a2a; color:#fff; border:1px solid #444; border-radius:5px;">
                </div>
                <div style="font-size: 12px; opacity: 0.7; margin-top: 5px;">Or cm: <input id="heightCm" name="heightCm" type="number" placeholder="cm" style="width: 60px; padding:5px; background:#2a2a2a; color:#fff; border:1px solid #444; border-radius:3px; margin-left: 5px;"></div>
            </div>
            <div style="flex: 1;">
                <label>Current Weight</label>
                <div style="display: flex; gap: 10px;">
                    <input id="weightLbs" name="weightLbs" type="number" placeholder="lbs" step="0.1" style="flex:1; padding:10px; background:#2a2a2a; color:#fff; border:1px solid #444; border-radius:5px;">
                    <input id="weightKg" name="weightKg" type="number" placeholder="kg" step="0.1" style="flex:1; padding:10px; background:#2a2a2a; color:#fff; border:1px solid #444; border-radius:5px;">
                </div>
            </div>
        </div>

        <!-- Body Composition -->
        <h3 style="color: #f5f5f5; margin: 25px 0 15px 0; border-bottom: 1px solid #333; padding-bottom: 8px;">Body Composition</h3>
        
        <div style="display: flex; gap: 15px; margin-bottom: 15px;">
            <div style="flex: 1;">
                <label>Body Fat % (if known)</label>
                <input id="bodyFat" name="bodyFat" type="number" step="0.1" placeholder="e.g. 12.5" style="width:100%; padding:10px; background:#2a2a2a; color:#fff; border:1px solid #444; border-radius:5px; margin-bottom:10px;">
            </div>
            <div style="flex: 1;">
                <label>Lean Mass (lbs - if known)</label>
                <input id="leanMass" name="leanMass" type="number" step="0.1" placeholder="Optional" style="width:100%; padding:10px; background:#2a2a2a; color:#fff; border:1px solid #444; border-radius:5px; margin-bottom:10px;">
            </div>
        </div>

        <!-- Training Details -->
        <h3 style="color: #f5f5f5; margin: 25px 0 15px 0; border-bottom: 1px solid #333; padding-bottom: 8px;">Training Details</h3>
        
        <div style="display: flex; gap: 15px; margin-bottom: 15px;">
            <div style="flex: 1;">
                <label>Training Days Per Week</label>
                <select id="trainingDays" name="trainingDays" required style="width:100%; padding:10px; background:#2a2a2a; color:#fff; border:1px solid #444; border-radius:5px; margin-bottom:10px;">
                    <option value="">Select</option>
                    <option value="2">2 days</option>
                    <option value="3">3 days</option>
                    <option value="4">4 days</option>
                    <option value="5">5 days</option>
                    <option value="6">6 days</option>
                    <option value="7">7 days</option>
                </select>
            </div>
            <div style="flex: 1;">
                <label>Session Duration</label>
                <select id="sessionDuration" name="sessionDuration" required style="width:100%; padding:10px; background:#2a2a2a; color:#fff; border:1px solid #444; border-radius:5px; margin-bottom:10px;">
                    <option value="">Select</option>
                    <option value="30">30-45 min</option>
                    <option value="60">45-75 min</option>
                    <option value="90">75-105 min</option>
                    <option value="120">105+ min</option>
                </select>
            </div>
        </div>

        <div style="display: flex; gap: 15px; margin-bottom: 15px;">
            <div style="flex: 1;">
                <label>Training Intensity</label>
                <select id="trainingIntensity" name="trainingIntensity" required style="width:100%; padding:10px; background:#2a2a2a; color:#fff; border:1px solid #444; border-radius:5px; margin-bottom:10px;">
                    <option value="">Select</option>
                    <option value="moderate">Moderate (RPE 6-7)</option>
                    <option value="high">High (RPE 7-8)</option>
                    <option value="veryHigh">Very High (RPE 8-9)</option>
                    <option value="extreme">Extreme (RPE 9-10)</option>
                </select>
            </div>
            <div style="flex: 1;">
                <label>Training Experience</label>
                <select id="experience" name="experience" required style="width:100%; padding:10px; background:#2a2a2a; color:#fff; border:1px solid #444; border-radius:5px; margin-bottom:10px;">
                    <option value="">Select</option>
                    <option value="beginner">< 2 years</option>
                    <option value="intermediate">2-5 years</option>
                    <option value="advanced">5-10 years</option>
                    <option value="expert">10+ years</option>
                </select>
            </div>
        </div>

        <!-- Cardio Activity -->
        <h3 style="color: #f5f5f5; margin: 25px 0 15px 0; border-bottom: 1px solid #333; padding-bottom: 8px;">Cardio Activity</h3>
        
        <div style="display: flex; gap: 15px; margin-bottom: 15px;">
            <div style="flex: 1;">
                <label>Cardio Sessions Per Week</label>
                <select id="cardioFreq" name="cardioFreq" required style="width:100%; padding:10px; background:#2a2a2a; color:#fff; border:1px solid #444; border-radius:5px; margin-bottom:10px;">
                    <option value="">Select</option>
                    <option value="0">None</option>
                    <option value="1">1-2 sessions</option>
                    <option value="3">3-4 sessions</option>
                    <option value="5">5-6 sessions</option>
                    <option value="7">Daily</option>
                </select>
            </div>
            <div style="flex: 1;">
                <label>Cardio Type</label>
                <select id="cardioType" name="cardioType" style="width:100%; padding:10px; background:#2a2a2a; color:#fff; border:1px solid #444; border-radius:5px; margin-bottom:10px;">
                    <option value="">Select (if applicable)</option>
                    <option value="liss">LISS</option>
                    <option value="miss">MISS</option>
                    <option value="hiit">HIIT</option>
                    <option value="mixed">Mixed</option>
                </select>
            </div>
        </div>

        <label>Cardio Duration</label>
        <select id="cardioDuration" name="cardioDuration" style="width:100%; padding:10px; background:#2a2a2a; color:#fff; border:1px solid #444; border-radius:5px; margin-bottom:15px;">
            <option value="">Select (if applicable)</option>
            <option value="15">10-20 min</option>
            <option value="30">20-40 min</option>
            <option value="45">40-60 min</option>
            <option value="60">60+ min</option>
        </select>

        <!-- Daily Activity -->
        <h3 style="color: #f5f5f5; margin: 25px 0 15px 0; border-bottom: 1px solid #333; padding-bottom: 8px;">Daily Activity</h3>
        
        <label>Job Activity Level</label>
        <select id="job" name="job" required style="width:100%; padding:10px; background:#2a2a2a; color:#fff; border:1px solid #444; border-radius:5px; margin-bottom:15px;">
            <option value="">Select</option>
            <option value="sedentary">Sedentary (desk job)</option>
            <option value="light">Light Activity</option>
            <option value="moderate">Moderate Activity</option>
            <option value="heavy">Heavy Activity</option>
        </select>

        <div style="display: flex; gap: 15px; margin-bottom: 15px;">
            <div style="flex: 1;">
                <label>Daily Steps (if tracked)</label>
                <input id="steps" name="steps" type="number" placeholder="e.g. 8000" style="width:100%; padding:10px; background:#2a2a2a; color:#fff; border:1px solid #444; border-radius:5px; margin-bottom:10px;">
            </div>
            <div style="flex: 1;">
                <label>Non-Exercise Activity</label>
                <select id="neat" name="neat" required style="width:100%; padding:10px; background:#2a2a2a; color:#fff; border:1px solid #444; border-radius:5px; margin-bottom:10px;">
                    <option value="">Select</option>
                    <option value="low">Low</option>
                    <option value="moderate">Moderate</option>
                    <option value="high">High</option>
                </select>
            </div>
        </div>

        <!-- Enhancement Status -->
        <h3 style="color: #f5f5f5; margin: 25px 0 15px 0; border-bottom: 1px solid #333; padding-bottom: 8px;">Enhancement Status</h3>
        
        <label>Current Status</label>
        <div style="display: flex; gap: 15px; margin-bottom: 15px;">
            <label style="display: flex; align-items: center; gap: 8px; cursor: pointer; background: #2a2a2a; padding: 10px; border-radius: 5px; border: 1px solid #444;">
                <input type="radio" id="natural" name="enhancement" value="natural" required>
                Natural
            </label>
            <label style="display: flex; align-items: center; gap: 8px; cursor: pointer; background: #2a2a2a; padding: 10px; border-radius: 5px; border: 1px solid #444;">
                <input type="radio" id="enhanced" name="enhancement" value="enhanced" required>
                Enhanced (TRT/PEDs)
            </label>
        </div>

        <div id="enhancementDetails" style="display: none;">
            <label>Current Compounds (optional)</label>
            <textarea id="compounds" name="compounds" rows="2" placeholder="e.g. Test 200mg/week" style="width:100%; padding:10px; background:#2a2a2a; color:#fff; border:1px solid #444; border-radius:5px; margin-bottom:15px; resize: vertical;"></textarea>
        </div>

        <!-- Goals & Lifestyle -->
        <h3 style="color: #f5f5f5; margin: 25px 0 15px 0; border-bottom: 1px solid #333; padding-bottom: 8px;">Goals & Lifestyle</h3>
        
        <div style="display: flex; gap: 15px; margin-bottom: 15px;">
            <div style="flex: 1;">
                <label>Primary Goal</label>
                <select id="goal" name="goal" required style="width:100%; padding:10px; background:#2a2a2a; color:#fff; border:1px solid #444; border-radius:5px; margin-bottom:10px;">
                    <option value="">Select</option>
                    <option value="maintain">Maintain physique</option>
                    <option value="lean_bulk">Lean bulk</option>
                    <option value="bulk">Moderate bulk</option>
                    <option value="cut">Fat loss/cutting</option>
                    <option value="recomp">Body recomposition</option>
                </select>
            </div>
            <div style="flex: 1;">
                <label>Training Phase</label>
                <select id="phase" name="phase" required style="width:100%; padding:10px; background:#2a2a2a; color:#fff; border:1px solid #444; border-radius:5px; margin-bottom:10px;">
                    <option value="">Select</option>
                    <option value="offseason">Off-season</option>
                    <option value="prep">Contest prep</option>
                    <option value="maintenance">Maintenance</option>
                    <option value="recovery">Recovery/Deload</option>
                </select>
            </div>
        </div>

        <div style="display: flex; gap: 15px; margin-bottom: 15px;">
            <div style="flex: 1;">
                <label>Sleep Per Night</label>
                <select id="sleep" name="sleep" required style="width:100%; padding:10px; background:#2a2a2a; color:#fff; border:1px solid #444; border-radius:5px; margin-bottom:10px;">
                    <option value="">Select</option>
                    <option value="5">< 6 hours</option>
                    <option value="6">6-7 hours</option>
                    <option value="7">7-8 hours</option>
                    <option value="8">8+ hours</option>
                </select>
            </div>
            <div style="flex: 1;">
                <label>Stress Level</label>
                <select id="stress" name="stress" required style="width:100%; padding:10px; background:#2a2a2a; color:#fff; border:1px solid #444; border-radius:5px; margin-bottom:10px;">
                    <option value="">Select</option>
                    <option value="low">Low</option>
                    <option value="moderate">Moderate</option>
                    <option value="high">High</option>
                </select>
            </div>
        </div>

        <div style="margin-bottom: 20px;">
            <label style="display: flex; align-items: center; gap: 10px; cursor: pointer; background: #2a2a2a; padding: 12px; border-radius: 5px; border: 1px solid #444;">
                <input type="checkbox" id="dietHistory" name="dietHistory">
                History of extreme dieting or metabolic damage
            </label>
        </div>

        <button type="submit" style="width:100%; padding:12px; font-size:16px; background-color:#333; color:white; border:none; border-radius:6px; cursor: pointer;">Calculate My Maintenance Macros</button>
    </form>

    <div id="mealPlanResponse" style="margin-top: 30px; white-space: pre-wrap; background: #1b1b1b; padding: 15px; border-radius: 8px; border: 1px solid #333; display: none;"></div>

    <button onclick="downloadImage()" style="display:none; margin-top: 15px; width: 100%; padding: 12px; font-size: 16px; background-color: #444; color: white; border: none; border-radius: 6px; cursor: pointer;" id="downloadBtn">Download Results as Image</button>

    <div style="margin-top: 30px; padding: 15px; background: #2a2a2a; border-radius: 8px; border: 1px solid #444; font-size: 12px; opacity: 0.8;">
        <strong>Educational Purpose:</strong> This tool is provided for educational purposes only. It does not promote or condone the use of performance-enhancing drugs. This is not medical advice. Always consult a licensed healthcare professional before making any decisions regarding diet, supplementation, or training.
    </div>
</div>

<script>
// Toggle enhancement details
document.querySelectorAll('input[name="enhancement"]').forEach(radio => {
    radio.addEventListener('change', function() {
        const details = document.getElementById('enhancementDetails');
        if (this.value === 'enhanced') {
            details.style.display = 'block';
        } else {
            details.style.display = 'none';
        }
    });
});

// Auto-convert height measurements
document.getElementById('heightCm').addEventListener('input', function() {
    if (this.value) {
        const cm = parseFloat(this.value);
        const totalInches = cm / 2.54;
        const feet = Math.floor(totalInches / 12);
        const inches = Math.round((totalInches % 12) * 10) / 10;
        
        document.getElementById('heightFeet').value = feet;
        document.getElementById('heightInches').value = inches;
    }
});

// Auto-convert weight measurements
document.getElementById('weightKg').addEventListener('input', function() {
    if (this.value) {
        const kg = parseFloat(this.value);
        const lbs = Math.round(kg * 2.20462 * 10) / 10;
        document.getElementById('weightLbs').value = lbs;
    }
});

document.getElementById('weightLbs').addEventListener('input', function() {
    if (this.value) {
        const lbs = parseFloat(this.value);
        const kg = Math.round(lbs / 2.20462 * 10) / 10;
        document.getElementById('weightKg').value = kg;
    }
});

// Maintenance Macro Calculation Logic
function calculateMaintenanceMacros(data) {
    // Convert measurements to standard units
    const weightLbs = parseFloat(data.weightLbs) || (parseFloat(data.weightKg) * 2.20462);
    const heightInches = (parseFloat(data.heightFeet) * 12) + parseFloat(data.heightInches) || (parseFloat(data.heightCm) / 2.54);
    const age = parseInt(data.age);
    
    // Calculate BMR using Mifflin-St Jeor equation
    let bmr;
    if (data.gender === 'male') {
        bmr = (10 * (weightLbs / 2.20462)) + (6.25 * (heightInches * 2.54)) - (5 * age) + 5;
    } else {
        bmr = (10 * (weightLbs / 2.20462)) + (6.25 * (heightInches * 2.54)) - (5 * age) - 161;
    }
    
    // Adjust BMR for body composition if known
    if (data.bodyFat && parseFloat(data.bodyFat) > 0) {
        const bodyFatPercent = parseFloat(data.bodyFat) / 100;
        const leanMass = weightLbs * (1 - bodyFatPercent);
        const muscleMultiplier = 1 + (leanMass / weightLbs - 0.75) * 0.3;
        bmr *= Math.max(0.9, Math.min(1.3, muscleMultiplier));
    }
    
    // Training Activity Multiplier
    let trainingMultiplier = 1.0;
    const trainingDays = parseInt(data.trainingDays);
    const sessionDuration = parseInt(data.sessionDuration);
    
    // Base training multiplier
    if (trainingDays >= 6) trainingMultiplier += 0.25;
    else if (trainingDays >= 4) trainingMultiplier += 0.20;
    else if (trainingDays >= 3) trainingMultiplier += 0.15;
    else trainingMultiplier += 0.10;
    
    // Session duration adjustment
    if (sessionDuration >= 120) trainingMultiplier += 0.08;
    else if (sessionDuration >= 90) trainingMultiplier += 0.06;
    else if (sessionDuration >= 60) trainingMultiplier += 0.04;
    else trainingMultiplier += 0.02;
    
    // Training intensity adjustment
    switch (data.trainingIntensity) {
        case 'extreme': trainingMultiplier += 0.12; break;
        case 'veryHigh': trainingMultiplier += 0.08; break;
        case 'high': trainingMultiplier += 0.05; break;
        case 'moderate': trainingMultiplier += 0.02; break;
    }
    
    // Experience level adjustment
    switch (data.experience) {
        case 'expert': trainingMultiplier += 0.05; break;
        case 'advanced': trainingMultiplier += 0.03; break;
        case 'intermediate': trainingMultiplier += 0.01; break;
    }
    
    // Cardio Activity Multiplier
    let cardioMultiplier = 1.0;
    const cardioFreq = parseInt(data.cardioFreq);
    const cardioDuration = parseInt(data.cardioDuration);
    
    if (cardioFreq > 0) {
        let cardioBase = cardioFreq * 0.02;
        
        if (cardioDuration >= 60) cardioBase *= 1.5;
        else if (cardioDuration >= 45) cardioBase *= 1.3;
        else if (cardioDuration >= 30) cardioBase *= 1.1;
        
        switch (data.cardioType) {
            case 'hiit': cardioBase *= 1.4; break;
            case 'miss': cardioBase *= 1.2; break;
            case 'mixed': cardioBase *= 1.3; break;
            case 'liss': cardioBase *= 1.0; break;
        }
        
        cardioMultiplier += cardioBase;
    }
    
    // Daily Activity/NEAT Multiplier
    let neatMultiplier = 1.0;
    
    switch (data.job) {
        case 'heavy': neatMultiplier += 0.30; break;
        case 'moderate': neatMultiplier += 0.20; break;
        case 'light': neatMultiplier += 0.10; break;
        case 'sedentary': neatMultiplier += 0.00; break;
    }
    
    switch (data.neat) {
        case 'high': neatMultiplier += 0.15; break;
        case 'moderate': neatMultiplier += 0.08; break;
        case 'low': neatMultiplier += 0.00; break;
    }
    
    if (data.steps) {
        const steps = parseInt(data.steps);
        if (steps >= 15000) neatMultiplier += 0.10;
        else if (steps >= 10000) neatMultiplier += 0.05;
        else if (steps >= 7500) neatMultiplier += 0.02;
    }
    
    // Enhancement Status Adjustment
    let enhancementMultiplier = 1.0;
    if (data.enhancement === 'enhanced') {
        enhancementMultiplier = 1.15;
    }
    
    // Lifestyle Factors
    let lifestyleMultiplier = 1.0;
    
    switch (data.sleep) {
        case '5': lifestyleMultiplier *= 0.95; break;
        case '6': lifestyleMultiplier *= 0.98; break;
        case '7': lifestyleMultiplier *= 1.00; break;
        case '8': lifestyleMultiplier *= 1.02; break;
    }
    
    switch (data.stress) {
        case 'high': lifestyleMultiplier *= 0.96; break;
        case 'moderate': lifestyleMultiplier *= 1.00; break;
        case 'low': lifestyleMultiplier *= 1.02; break;
    }
    
    if (data.dietHistory) {
        lifestyleMultiplier *= 0.92;
    }
    
    // Training phase adjustment
    let phaseMultiplier = 1.0;
    switch (data.phase) {
        case 'prep': phaseMultiplier = 0.95; break;
        case 'recovery': phaseMultiplier = 0.98; break;
        case 'maintenance': phaseMultiplier = 1.00; break;
        case 'offseason': phaseMultiplier = 1.02; break;
    }
    
    // Calculate TDEE
    const tdee = Math.round(bmr * trainingMultiplier * cardioMultiplier * neatMultiplier * enhancementMultiplier * lifestyleMultiplier * phaseMultiplier);
    
    // Macro Distribution
    const proteinGrams = Math.round(weightLbs * 1.1);
    const proteinCalories = proteinGrams * 4;
    
    const fatPercentage = data.gender === 'male' ? 0.25 : 0.28;
    const fatCalories = Math.round(tdee * fatPercentage);
    const fatGrams = Math.round(fatCalories / 9);
    
    const carbCalories = tdee - proteinCalories - fatCalories;
    const carbGrams = Math.round(carbCalories / 4);
    
    return {
        tdee: tdee,
        protein: { grams: proteinGrams, calories: proteinCalories },
        carbs: { grams: carbGrams, calories: carbCalories },
        fats: { grams: fatGrams, calories: fatCalories },
        bmr: Math.round(bmr)
    };
}

// Display Results
function displayResults(results) {
    const today = new Date();
    const formattedDate = today.toLocaleDateString("en-CA", {
        year: "numeric",
        month: "short",
        day: "numeric"
    });

    const resultsText = `BUILT FUEL CALCULATOR RESULTS – ${formattedDate}

MAINTENANCE MACROS:
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

🔥 DAILY CALORIES: ${results.tdee}

💪 PROTEIN: ${results.protein.grams}g (${results.protein.calories} calories)
🍞 CARBS: ${results.carbs.grams}g (${results.carbs.calories} calories)  
🥑 FATS: ${results.fats.grams}g (${results.fats.calories} calories)

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

BUILT TRAINING NOTES:
• BMR: ${results.bmr} calories (base metabolic rate)
• Protein: 1.1g per lb bodyweight for muscle preservation
• Fats: 25-28% of calories for hormone optimization
• Carbs: Remaining calories to fuel training
• Monitor weight/performance, adjust ±100-200 calories if needed

Remember: These are MAINTENANCE macros for sustainable bodybuilding without burnout.`;

    document.getElementById("mealPlanResponse").innerText = resultsText;
    document.getElementById("mealPlanResponse").style.display = "block";
    document.getElementById("downloadBtn").style.display = "block";
    
    document.getElementById("mealPlanResponse").scrollIntoView({ behavior: 'smooth' });
}

function downloadImage() {
    const mealPlanElement = document.getElementById("mealPlanResponse");

    const today = new Date();
    const formattedDate = today.toLocaleDateString("en-CA", {
        year: "numeric",
        month: "short",
        day: "numeric"
    });

    // Create a temporary wrapper for the image
    const wrapper = document.createElement("div");
    wrapper.style.background = "#fff";
    wrapper.style.color = "#000";
    wrapper.style.padding = "40px";
    wrapper.style.fontFamily = "Arial, sans-serif";
    wrapper.style.maxWidth = "700px";
    wrapper.style.lineHeight = "1.6";

    const content = document.createElement("pre");
    content.innerText = mealPlanElement.innerText;
    content.style.whiteSpace = "pre-wrap";
    content.style.fontSize = "14px";
    content.style.color = "#000";

    wrapper.appendChild(content);
    document.body.appendChild(wrapper);

    // Use html2canvas if available, otherwise fallback to simple download
    if (typeof html2canvas !== 'undefined') {
        html2canvas(wrapper, { scale: 2 }).then(canvas => {
            const link = document.createElement("a");
            link.download = `BUILT_Fuel_Calculator_${formattedDate.replace(/\s/g, "_")}.png`;
            link.href = canvas.toDataURL();
            link.click();
            document.body.removeChild(wrapper);
        });
    } else {
        // Fallback - just copy to clipboard or save as text
        navigator.clipboard.writeText(mealPlanElement.innerText).then(() => {
            alert('Results copied to clipboard!');
        });
        document.body.removeChild(wrapper);
    }
}

// Form submission handler
document.getElementById('macroCalculator').addEventListener('submit', function(e) {
    e.preventDefault();
    
    const formData = new FormData(this);
    const data = {};
    
    for (let [key, value] of formData.entries()) {
        data[key] = value;
    }
    
    data.dietHistory = document.getElementById('dietHistory').checked;
    
    // Validate required fields
    if (!data.age || !data.gender || (!data.weightLbs && !data.weightKg) || 
        (!data.heightFeet && !data.heightCm) || !data.trainingDays) {
        alert('Please fill in all required fields before calculating.');
        return;
    }
    
    const results = calculateMaintenanceMacros(data);
    displayResults(results);
});
</script>
</body>
</html>
